# 项目说明

参考 b 站视频教程做的生成 emoji 图片的网站，使用 cursur 辅助开发。
教程地址：
https://www.bilibili.com/video/BV1kB41eZEUt

supabase 的 sql:

```sql
create table emoji_likes (
  user_id text references profiles(user_id),
  emoji_id bigint references emojis(id),
  primary key (user_id, emoji_id)
);

CREATE TABLE emojis (
id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
image_url TEXT NOT NULL,
prompt TEXT NOT NULL,
likes_count NUMERIC DEFAULT 0,
creator_user_id TEXT NOT NULL,
created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

CREATE TABLE profiles (
user_id TEXT PRIMARY KEY,
credits INTEGER DEFAULT 3 NOT NULL,
tier TEXT NOT NULL DEFAULT 'free' CHECK (tier IN ('free', 'pro')),
stripe_customer_id TEXT,
stripe_subscription_id TEXT,
created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL
);

create or replace function update_emoji_likes_count(emoji_id bigint)
returns table (likes_count bigint) as $$
declare
  new_count bigint;
begin
  select count(*) into new_count
  from emoji_likes
  where emoji_likes.emoji_id = $1;

  update emojis
  set likes_count = new_count
  where id = $1;

  return query select new_count as likes_count;
end;
$$ language plpgsql;

```
